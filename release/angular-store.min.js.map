{"version":3,"sources":["angular-store.min.js","store.service.js","stores/baseStore.service.js","stores/collectionStore.js","stores/instanceStore.js"],"names":["window","angular","undefined","module","provider","this","defaults","model","methods","service","verbose","collections","setVerbose","registerStore","name","config","$get","$log","$injector","Store","store","forEach","extend","info","has","error","StoreService","get","StoreInstance","warn","_typeof","Symbol","iterator","obj","constructor","factory","$q","validateModel","item","Model","convert","BaseStore","Object","defineProperty","prototype","warnMissingMethod","method","validateIsModel","_this","isArray","models","map","filter","resolve","reject","$baseStore","CollectionStore","call","collection","Map","isLoaded","cacheEmpty","query","refresh","Array","from","values","isFunction","dataKey","then","data","Error","items","add","length","clear","id","findById","_this2","save","_this3","_this4","remove","load","_this5","_this6","set","_this7","InstanceStore","instance","promise"],"mappings":"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","file":"angular-store.min.js","sourcesContent":["/**\n * @meanie/angular-store * https://github.com/meanie/angular-store\n *\n * Copyright (c) 2020 Adam Reis <adam@reis.nz>\n * License: MIT\n */\n(function (window, angular, undefined) {\n  'use strict';\n\n  /**\n   * Module definition and dependencies\n   */\n\n  angular.module('Store.Service', ['Store.BaseStore.Service', 'Store.CollectionStore.Service', 'Store.InstanceStore.Service'])\n\n  /**\n   * Model definition\n   */\n  .provider('$store', function $storeProvider() {\n\n    //Defaults\n    this.defaults = {\n      model: '',\n      methods: null,\n      service: '$collectionStore',\n      verbose: false\n    };\n\n    //Registered stores\n    this.collections = {};\n\n    /**\n     * Set verbose\n     */\n    this.setVerbose = function (verbose) {\n      this.defaults.verbose = !!verbose;\n      return this;\n    };\n\n    /**\n     * Register a new store\n     */\n    this.registerStore = function (name, config) {\n      if (name) {\n        this.collections[name] = config || {};\n      }\n      return this;\n    };\n\n    /**\n     * Service getter\n     */\n    this.$get = ['$log', '$injector', function ($log, $injector) {\n\n      //Initialize store interface\n      var Store = function Store(store) {\n        return this[store];\n      };\n\n      //Append all stores\n      angular.forEach(this.collections, function (config, name) {\n\n        //Extend store config with defaults\n        config = angular.extend({}, this.defaults, config);\n\n        //Verbose info\n        if (config.verbose) {\n          $log.info('Store', name + ':', config);\n        }\n\n        //Make sure we have a valid store service\n        if (!config.service || !$injector.has(config.service)) {\n          return $log.error('Unknown service', config.service, 'specified for', name, 'store');\n        }\n\n        //Make sure we have a valid model specified\n        if (!config.model || !$injector.has(config.model)) {\n          return $log.error('Unknown model specified for', name, 'store:', config.model);\n        }\n\n        //Initialize store\n        var StoreService = $injector.get(config.service);\n        var StoreInstance = new StoreService(name, config);\n\n        //Check if overwriting\n        if (Store[name]) {\n          $log.warn('Store', name, 'is being overwritten.');\n        }\n\n        //Set\n        Store[name] = StoreInstance;\n      }, this);\n\n      //Return\n      return Store;\n    }];\n  });\n})(window, window.angular);\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\n(function (window, angular, undefined) {\n  'use strict';\n\n  /**\n   * Module definition and dependencies\n   */\n\n  angular.module('Store.BaseStore.Service', [])\n\n  /**\n   * Base store\n   */\n  .factory('$baseStore', ['$q', '$log', '$injector', function $baseStore($q, $log, $injector) {\n\n    /**\n     * Helper to validate a model\n     */\n    function validateModel(item, Model, convert) {\n      if (item instanceof Model) {\n        return item;\n      }\n      if (convert && (typeof item === 'undefined' ? 'undefined' : _typeof(item)) === 'object') {\n        return new Model(item);\n      }\n      return null;\n    }\n\n    /**\n     * Constructor\n     */\n    function BaseStore(name, config) {\n\n      //Defaults\n      this.name = name;\n      this.config = config;\n\n      //Create dynamic model property to bypass injector circular dependency\n      var Model = null;\n      Object.defineProperty(this, 'model', {\n        get: function get() {\n          Model = Model || $injector.get(config.model);\n          return Model;\n        }\n      });\n    }\n\n    /**\n     * Method warning logger\n     */\n    BaseStore.prototype.warnMissingMethod = function (method) {\n      $log.warn('No static `' + method + '` method present on model for', this.name, 'store');\n    };\n\n    /**\n     * Check if an item is a valid model, optionally converting to a model\n     */\n    BaseStore.prototype.validateIsModel = function (item, convert) {\n      var _this = this;\n\n      //Handle array of items\n      if (angular.isArray(item)) {\n        var models = item.map(function (item) {\n          return validateModel(item, _this.model, convert);\n        }).filter(function (item) {\n          return !!item;\n        });\n        return $q.resolve(models);\n      }\n\n      //Handle single item\n      var model = validateModel(item, this.model, convert);\n      if (model !== null) {\n        return $q.resolve(model);\n      }\n      $log.warn('Invalid object passed to', this.name, 'store as model:', item);\n      return $q.reject('Invalid model');\n    };\n\n    //Return\n    return BaseStore;\n  }]);\n})(window, window.angular);\n(function (window, angular, undefined) {\n  'use strict';\n\n  /**\n   * Module definition and dependencies\n   */\n\n  angular.module('Store.CollectionStore.Service', ['Store.BaseStore.Service'])\n\n  /**\n   * Collection store factory\n   */\n  .factory('$collectionStore', ['$q', '$log', '$baseStore', function $collectionStore($q, $log, $baseStore) {\n\n    /**\n     * Constructor\n     */\n    function CollectionStore(name, config) {\n\n      //Call parent constructor\n      $baseStore.call(this, name, config);\n\n      //Prepare collection\n      this.collection = new Map();\n      this.isLoaded = false;\n      this.cacheEmpty = config.cacheEmpty || false;\n    }\n\n    /**\n     * Extend prototype\n     */\n    angular.extend(CollectionStore.prototype, $baseStore.prototype);\n\n    /**\n     * Query items from model\n     */\n    CollectionStore.prototype.query = function (filter, refresh) {\n      var _this = this;\n\n      //Boolean passed as filter? Assume it's the refresh parameter\n      if (typeof filter === 'boolean') {\n        refresh = filter;\n        filter = null;\n      }\n\n      //Loaded already?\n      if (this.isLoaded && !filter && !refresh) {\n        return $q.resolve(Array.from(this.collection.values()));\n      }\n\n      //Ensure method exists on model\n      if (!angular.isFunction(this.model.query)) {\n        this.warnMissingMethod('query');\n        return $q.resolve([]);\n      }\n\n      //Get data key from config\n      var dataKey = this.config.dataKey;\n\n      //Query from server\n\n      return this.model.query(filter).then(function (data) {\n        if (dataKey && Array.isArray(data[dataKey])) {\n          return data[dataKey];\n        } else if (Array.isArray(data)) {\n          return data;\n        }\n        throw new Error('Unexpected data format for ' + _this.name + ' store');\n      }).then(function (items) {\n\n        //Add the items\n        items.forEach(function (item) {\n          return _this.add(item);\n        });\n\n        //If this wasn't a filter query, mark as loaded\n        if (!filter && (items.length > 0 || _this.cacheEmpty)) {\n          _this.isLoaded = true;\n        }\n\n        //Return the items\n        return items;\n      });\n    };\n\n    /**\n     * Clear the store\n     */\n    CollectionStore.prototype.clear = function () {\n      this.collection.clear();\n      this.isLoaded = false;\n      return $q.resolve();\n    };\n\n    /**\n     * Check if has item by ID\n     */\n    CollectionStore.prototype.has = function (id) {\n      return this.collection.has(id);\n    };\n\n    /**\n     * Find item by ID\n     */\n    CollectionStore.prototype.findById = function (id, refresh) {\n      var _this2 = this;\n\n      //Present and don't want to refresh?\n      if (!refresh && this.collection.has(id)) {\n        return $q.resolve(this.collection.get(id));\n      }\n\n      //Ensure method exists on model\n      if (!angular.isFunction(this.model.findById)) {\n        this.warnMissingMethod('findById');\n        return $q.resolve(null);\n      }\n\n      //Find on server\n      return this.model.findById(id).then(function (item) {\n        return _this2.add(item);\n      });\n    };\n\n    /**\n     * Save item (create or update)\n     */\n    CollectionStore.prototype.save = function (item, data) {\n      var _this3 = this;\n\n      return this.validateIsModel(item, true).then(function (item) {\n        return item.save(data);\n      }).then(function (item) {\n        return _this3.add(item);\n      });\n    };\n\n    /**\n     * Delete item\n     */\n    CollectionStore.prototype.delete = function (item) {\n      var _this4 = this;\n\n      return this.validateIsModel(item).then(function (item) {\n        return item.delete();\n      }).then(function (item) {\n        return _this4.remove(item);\n      });\n    };\n\n    /**\n     * Load items into store manually\n     */\n    CollectionStore.prototype.load = function (items) {\n      var _this5 = this;\n\n      items = items || [];\n      return this.validateIsModel(items, true).then(function (items) {\n        return _this5.add(items);\n      }).finally(function () {\n        _this5.isLoaded = true;\n      });\n    };\n\n    /**************************************************************************\n     * Helper methods\n     ***/\n\n    /**\n     * Add item to store (without creating on server)\n     */\n    CollectionStore.prototype.add = function (item) {\n      var _this6 = this;\n\n      if (angular.isArray(item)) {\n        item.forEach(function (item) {\n          return _this6.collection.set(item.id, item);\n        });\n      } else {\n        if (typeof item.id === 'undefined') {\n          $log.warn('Trying to add item to', this.name, ' store,', 'but no `id` property present on item:', item);\n          return $q.reject();\n        }\n        this.collection.set(item.id, item);\n      }\n      return $q.resolve(item);\n    };\n\n    /**\n     * Remove item from store (without deleting from server)\n     */\n    CollectionStore.prototype.remove = function (item) {\n      var _this7 = this;\n\n      if (angular.isArray(item)) {\n        item.forEach(function (item) {\n          return _this7.collection.delete(item.id);\n        });\n      } else {\n        if (typeof item.id === 'undefined') {\n          $log.warn('Trying to remove item from', this.name, ' store,', 'but no `id` property present on item:', item);\n          return $q.reject();\n        }\n        this.collection.delete(item.id);\n      }\n      return $q.resolve(item);\n    };\n\n    //Return\n    return CollectionStore;\n  }]);\n})(window, window.angular);\n(function (window, angular, undefined) {\n  'use strict';\n\n  /**\n   * Module definition and dependencies\n   */\n\n  angular.module('Store.InstanceStore.Service', ['Store.BaseStore.Service'])\n\n  /**\n   * Instance store factory\n   */\n  .factory('$instanceStore', ['$q', '$baseStore', function $instanceStore($q, $baseStore) {\n\n    /**\n     * Constructor\n     */\n    function InstanceStore(name, config) {\n\n      //Call parent constructor\n      $baseStore.call(this, name, config);\n\n      //Prepare instance and promise placeholders\n      this.instance = null;\n      this.promise = null;\n      this.cacheEmpty = config.cacheEmpty || false;\n    }\n\n    /**\n     * Extend prototype\n     */\n    angular.extend(InstanceStore.prototype, $baseStore.prototype);\n\n    /**\n     * Get single instance from store\n     */\n    InstanceStore.prototype.get = function (filter, refresh) {\n      var _this = this;\n\n      //Boolean given as filter\n      if (typeof filter === 'boolean') {\n        refresh = filter;\n        filter = null;\n      }\n\n      //Already present, or loaded but not present and allow empty caching?\n      if ((this.instance || this.isLoaded && this.cacheEmpty) && !refresh) {\n        return $q.resolve(this.instance);\n      }\n\n      //Promise present?\n      if (this.promise) {\n        return this.promise;\n      }\n\n      //Ensure method exists on model\n      if (!angular.isFunction(this.model.get)) {\n        this.warnMissingMethod('get');\n        return $q.resolve([]);\n      }\n\n      //Get from server\n      this.promise = this.model.get(filter).then(function (instance) {\n        _this.isLoaded = true;\n        _this.instance = instance;\n        return instance;\n      }).finally(function () {\n        return _this.promise = null;\n      });\n\n      //Return promise\n      return this.promise;\n    };\n\n    /**\n     * Set single instance in the store\n     */\n    InstanceStore.prototype.set = function (instance) {\n      var _this2 = this;\n\n      return this.validateIsModel(instance, true).then(function (instance) {\n        _this2.isLoaded = true;\n        _this2.instance = instance;\n        return instance;\n      });\n    };\n\n    /**\n     * Clear the store\n     */\n    InstanceStore.prototype.clear = function () {\n      this.instance = null;\n      this.isLoaded = false;\n      return $q.resolve();\n    };\n\n    /**\n     * Save item (create or update)\n     */\n    InstanceStore.prototype.save = function (item, data) {\n      return this.validateIsModel(item, true).then(function (item) {\n        return item.save(data);\n      });\n    };\n\n    //Return\n    return InstanceStore;\n  }]);\n})(window, window.angular);","(function(window, angular, undefined) {'use strict';\n\n/**\n * Module definition and dependencies\n */\nangular.module('Store.Service', [\n  'Store.BaseStore.Service',\n  'Store.CollectionStore.Service',\n  'Store.InstanceStore.Service',\n])\n\n/**\n * Model definition\n */\n.provider('$store', function $storeProvider() {\n\n  //Defaults\n  this.defaults = {\n    model: '',\n    methods: null,\n    service: '$collectionStore',\n    verbose: false,\n  };\n\n  //Registered stores\n  this.collections = {};\n\n  /**\n   * Set verbose\n   */\n  this.setVerbose = function(verbose) {\n    this.defaults.verbose = !!verbose;\n    return this;\n  };\n\n  /**\n   * Register a new store\n   */\n  this.registerStore = function(name, config) {\n    if (name) {\n      this.collections[name] = config || {};\n    }\n    return this;\n  };\n\n  /**\n   * Service getter\n   */\n  this.$get = function($log, $injector) {\n\n    //Initialize store interface\n    let Store = function(store) {\n      return this[store];\n    };\n\n    //Append all stores\n    angular.forEach(this.collections, function(config, name) {\n\n      //Extend store config with defaults\n      config = angular.extend({}, this.defaults, config);\n\n      //Verbose info\n      if (config.verbose) {\n        $log.info('Store', name + ':', config);\n      }\n\n      //Make sure we have a valid store service\n      if (!config.service || !$injector.has(config.service)) {\n        return $log.error(\n          'Unknown service', config.service, 'specified for', name, 'store'\n        );\n      }\n\n      //Make sure we have a valid model specified\n      if (!config.model || !$injector.has(config.model)) {\n        return $log.error(\n          'Unknown model specified for', name, 'store:', config.model\n        );\n      }\n\n      //Initialize store\n      let StoreService = $injector.get(config.service);\n      let StoreInstance = new StoreService(name, config);\n\n      //Check if overwriting\n      if (Store[name]) {\n        $log.warn('Store', name, 'is being overwritten.');\n      }\n\n      //Set\n      Store[name] = StoreInstance;\n    }, this);\n\n    //Return\n    return Store;\n  };\n});\n\n})(window, window.angular);\n","(function(window, angular, undefined) {'use strict';\n\n/**\n * Module definition and dependencies\n */\nangular.module('Store.BaseStore.Service', [])\n\n/**\n * Base store\n */\n.factory('$baseStore', function $baseStore($q, $log, $injector) {\n\n  /**\n   * Helper to validate a model\n   */\n  function validateModel(item, Model, convert) {\n    if (item instanceof Model) {\n      return item;\n    }\n    if (convert && typeof item === 'object') {\n      return new Model(item);\n    }\n    return null;\n  }\n\n  /**\n   * Constructor\n   */\n  function BaseStore(name, config) {\n\n    //Defaults\n    this.name = name;\n    this.config = config;\n\n    //Create dynamic model property to bypass injector circular dependency\n    let Model = null;\n    Object.defineProperty(this, 'model', {\n      get() {\n        Model = Model || $injector.get(config.model);\n        return Model;\n      }\n    });\n  }\n\n  /**\n   * Method warning logger\n   */\n  BaseStore.prototype.warnMissingMethod = function(method) {\n    $log.warn('No static `' + method + '` method present on model for',\n      this.name, 'store');\n  };\n\n  /**\n   * Check if an item is a valid model, optionally converting to a model\n   */\n  BaseStore.prototype.validateIsModel = function(item, convert) {\n\n    //Handle array of items\n    if (angular.isArray(item)) {\n      let models = item\n        .map(item => validateModel(item, this.model, convert))\n        .filter(item => !!item);\n      return $q.resolve(models);\n    }\n\n    //Handle single item\n    let model = validateModel(item, this.model, convert);\n    if (model !== null) {\n      return $q.resolve(model);\n    }\n    $log.warn('Invalid object passed to', this.name, 'store as model:', item);\n    return $q.reject('Invalid model');\n  };\n\n  //Return\n  return BaseStore;\n});\n\n})(window, window.angular);\n","(function(window, angular, undefined) {'use strict';\n\n/**\n * Module definition and dependencies\n */\nangular.module('Store.CollectionStore.Service', [\n  'Store.BaseStore.Service',\n])\n\n/**\n * Collection store factory\n */\n.factory('$collectionStore', function $collectionStore($q, $log, $baseStore) {\n\n  /**\n   * Constructor\n   */\n  function CollectionStore(name, config) {\n\n    //Call parent constructor\n    $baseStore.call(this, name, config);\n\n    //Prepare collection\n    this.collection = new Map();\n    this.isLoaded = false;\n    this.cacheEmpty = config.cacheEmpty || false;\n  }\n\n  /**\n   * Extend prototype\n   */\n  angular.extend(CollectionStore.prototype, $baseStore.prototype);\n\n  /**\n   * Query items from model\n   */\n  CollectionStore.prototype.query = function(filter, refresh) {\n\n    //Boolean passed as filter? Assume it's the refresh parameter\n    if (typeof filter === 'boolean') {\n      refresh = filter;\n      filter = null;\n    }\n\n    //Loaded already?\n    if (this.isLoaded && !filter && !refresh) {\n      return $q.resolve(Array.from(this.collection.values()));\n    }\n\n    //Ensure method exists on model\n    if (!angular.isFunction(this.model.query)) {\n      this.warnMissingMethod('query');\n      return $q.resolve([]);\n    }\n\n    //Get data key from config\n    const {dataKey} = this.config;\n\n    //Query from server\n    return this.model\n      .query(filter)\n      .then(data => {\n        if (dataKey && Array.isArray(data[dataKey])) {\n          return data[dataKey];\n        }\n        else if (Array.isArray(data)) {\n          return data;\n        }\n        throw new Error(`Unexpected data format for ${this.name} store`);\n      })\n      .then(items => {\n\n        //Add the items\n        items.forEach(item => this.add(item));\n\n        //If this wasn't a filter query, mark as loaded\n        if (!filter && (items.length > 0 || this.cacheEmpty)) {\n          this.isLoaded = true;\n        }\n\n        //Return the items\n        return items;\n      });\n  };\n\n  /**\n   * Clear the store\n   */\n  CollectionStore.prototype.clear = function() {\n    this.collection.clear();\n    this.isLoaded = false;\n    return $q.resolve();\n  };\n\n  /**\n   * Check if has item by ID\n   */\n  CollectionStore.prototype.has = function(id) {\n    return this.collection.has(id);\n  };\n\n  /**\n   * Find item by ID\n   */\n  CollectionStore.prototype.findById = function(id, refresh) {\n\n    //Present and don't want to refresh?\n    if (!refresh && this.collection.has(id)) {\n      return $q.resolve(this.collection.get(id));\n    }\n\n    //Ensure method exists on model\n    if (!angular.isFunction(this.model.findById)) {\n      this.warnMissingMethod('findById');\n      return $q.resolve(null);\n    }\n\n    //Find on server\n    return this.model.findById(id).then(item => this.add(item));\n  };\n\n  /**\n   * Save item (create or update)\n   */\n  CollectionStore.prototype.save = function(item, data) {\n    return this.validateIsModel(item, true)\n      .then(item => item.save(data))\n      .then(item => this.add(item));\n  };\n\n  /**\n   * Delete item\n   */\n  CollectionStore.prototype.delete = function(item) {\n    return this.validateIsModel(item)\n      .then(item => item.delete())\n      .then(item => this.remove(item));\n  };\n\n  /**\n   * Load items into store manually\n   */\n  CollectionStore.prototype.load = function(items) {\n    items = items || [];\n    return this.validateIsModel(items, true)\n      .then(items => this.add(items))\n      .finally(() => {\n        this.isLoaded = true;\n      });\n  };\n\n  /**************************************************************************\n   * Helper methods\n   ***/\n\n  /**\n   * Add item to store (without creating on server)\n   */\n  CollectionStore.prototype.add = function(item) {\n    if (angular.isArray(item)) {\n      item.forEach(item => this.collection.set(item.id, item));\n    }\n    else {\n      if (typeof item.id === 'undefined') {\n        $log.warn(\n          'Trying to add item to', this.name, ' store,',\n          'but no `id` property present on item:', item\n        );\n        return $q.reject();\n      }\n      this.collection.set(item.id, item);\n    }\n    return $q.resolve(item);\n  };\n\n  /**\n   * Remove item from store (without deleting from server)\n   */\n  CollectionStore.prototype.remove = function(item) {\n    if (angular.isArray(item)) {\n      item.forEach(item => this.collection.delete(item.id));\n    }\n    else {\n      if (typeof item.id === 'undefined') {\n        $log.warn(\n          'Trying to remove item from', this.name, ' store,',\n          'but no `id` property present on item:', item\n        );\n        return $q.reject();\n      }\n      this.collection.delete(item.id);\n    }\n    return $q.resolve(item);\n  };\n\n  //Return\n  return CollectionStore;\n});\n\n})(window, window.angular);\n","(function(window, angular, undefined) {'use strict';\n\n/**\n * Module definition and dependencies\n */\nangular.module('Store.InstanceStore.Service', [\n  'Store.BaseStore.Service',\n])\n\n/**\n * Instance store factory\n */\n.factory('$instanceStore', function $instanceStore($q, $baseStore) {\n\n  /**\n   * Constructor\n   */\n  function InstanceStore(name, config) {\n\n    //Call parent constructor\n    $baseStore.call(this, name, config);\n\n    //Prepare instance and promise placeholders\n    this.instance = null;\n    this.promise = null;\n    this.cacheEmpty = config.cacheEmpty || false;\n  }\n\n  /**\n   * Extend prototype\n   */\n  angular.extend(InstanceStore.prototype, $baseStore.prototype);\n\n  /**\n   * Get single instance from store\n   */\n  InstanceStore.prototype.get = function(filter, refresh) {\n\n    //Boolean given as filter\n    if (typeof filter === 'boolean') {\n      refresh = filter;\n      filter = null;\n    }\n\n    //Already present, or loaded but not present and allow empty caching?\n    if ((this.instance || (this.isLoaded && this.cacheEmpty)) && !refresh) {\n      return $q.resolve(this.instance);\n    }\n\n    //Promise present?\n    if (this.promise) {\n      return this.promise;\n    }\n\n    //Ensure method exists on model\n    if (!angular.isFunction(this.model.get)) {\n      this.warnMissingMethod('get');\n      return $q.resolve([]);\n    }\n\n    //Get from server\n    this.promise = this.model\n      .get(filter)\n      .then(instance => {\n        this.isLoaded = true;\n        this.instance = instance;\n        return instance;\n      })\n      .finally(() => this.promise = null);\n\n    //Return promise\n    return this.promise;\n  };\n\n  /**\n   * Set single instance in the store\n   */\n  InstanceStore.prototype.set = function(instance) {\n    return this.validateIsModel(instance, true)\n      .then(instance => {\n        this.isLoaded = true;\n        this.instance = instance;\n        return instance;\n      })\n  };\n\n  /**\n   * Clear the store\n   */\n  InstanceStore.prototype.clear = function() {\n    this.instance = null;\n    this.isLoaded = false;\n    return $q.resolve();\n  };\n\n  /**\n   * Save item (create or update)\n   */\n  InstanceStore.prototype.save = function(item, data) {\n    return this.validateIsModel(item, true)\n      .then(item => item.save(data));\n  };\n\n  //Return\n  return InstanceStore;\n});\n\n})(window, window.angular);\n"],"sourceRoot":"/source/"}