!function(e,t,o){"use strict";t.module("Store.Service",["Store.BaseStore.Service","Store.CollectionStore.Service","Store.InstanceStore.Service"]).provider("$store",function(){this.defaults={model:"",methods:null,service:"$collectionStore",verbose:!1},this.collections={},this.setVerbose=function(e){return this.defaults.verbose=!!e,this},this.registerStore=function(e,t){return e&&(this.collections[e]=t||{}),this},this.$get=["$log","$injector",function(e,o){var n=function(e){return this[e]};return t.forEach(this.collections,function(r,i){if(r=t.extend({},this.defaults,r),r.verbose&&e.info("Store",i+":",r),!r.service||!o.has(r.service))return e.error("Unknown service",r.service,"specified for",i,"store");if(!r.model||!o.has(r.model))return e.error("Unknown model specified for",i,"store:",r.model);var s=o.get(r.service),c=new s(i,r);n[i]&&e.warn("Store",i,"is being overwritten."),n[i]=c},this),n}]})}(window,window.angular);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e,t,o){"use strict";t.module("Store.BaseStore.Service",[]).factory("$baseStore",["$q","$log","$injector",function(e,o,n){function r(e,t,o){return e instanceof t?e:o&&"object"===("undefined"==typeof e?"undefined":_typeof(e))?new t(e):null}function i(e,t){this.name=e,this.config=t;var o=null;Object.defineProperty(this,"model",{get:function(){return o=o||n.get(t.model)}})}return i.prototype.warnMissingMethod=function(e){o.warn("No static `"+e+"` method present on model for",this.name,"store")},i.prototype.validateIsModel=function(n,i){var s=this;if(t.isArray(n)){var c=n.map(function(e){return r(e,s.model,i)}).filter(function(e){return!!e});return e.resolve(c)}var u=r(n,this.model,i);return null!==u?e.resolve(u):(o.warn("Invalid object passed to",this.name,"store as model:",n),e.reject("Invalid model"))},i}])}(window,window.angular),function(e,t,o){"use strict";t.module("Store.CollectionStore.Service",["Store.BaseStore.Service"]).factory("$collectionStore",["$q","$log","$baseStore",function(e,o,n){function r(e,t){n.call(this,e,t),this.collection=new Map,this.isLoaded=!1}return t.extend(r.prototype,n.prototype),r.prototype.query=function(o,n){var r=this;if("boolean"==typeof o&&(n=o,o=null),this.isLoaded&&!o&&!n)return e.resolve(Array.from(this.collection.values()));if(!t.isFunction(this.model.query))return this.warnMissingMethod("query"),e.resolve([]);var i=this.config.dataKey;return this.model.query(o).then(function(e){if(i&&Array.isArray(e[i]))return e[i];if(Array.isArray(e))return e;throw new Error("Unexpected data format for "+r.name+" store")}).then(function(e){return e.forEach(function(e){return r.add(e)}),o||(r.isLoaded=!0),e})},r.prototype.clear=function(){return this.collection.clear(),this.isLoaded=!1,e.resolve()},r.prototype.has=function(e){return this.collection.has(e)},r.prototype.findById=function(o,n){var r=this;return!n&&this.collection.has(o)?e.resolve(this.collection.get(o)):t.isFunction(this.model.findById)?this.model.findById(o).then(function(e){return r.add(e)}):(this.warnMissingMethod("findById"),e.resolve(null))},r.prototype.save=function(e,t){var o=this;return this.validateIsModel(e,!0).then(function(e){return e.save(t)}).then(function(e){return o.add(e)})},r.prototype["delete"]=function(e){var t=this;return this.validateIsModel(e).then(function(e){return e["delete"]()}).then(function(e){return t.remove(e)})},r.prototype.load=function(e){var t=this;return e=e||[],this.validateIsModel(e,!0).then(function(e){return t.add(e)})["finally"](function(){t.isLoaded=!0})},r.prototype.add=function(n){var r=this;if(t.isArray(n))n.forEach(function(e){return r.collection.set(e.id,e)});else{if("undefined"==typeof n.id)return o.warn("Trying to add item to",this.name," store,","but no `id` property present on item:",n),e.reject();this.collection.set(n.id,n)}return e.resolve(n)},r.prototype.remove=function(n){var r=this;if(t.isArray(n))n.forEach(function(e){return r.collection["delete"](e.id)});else{if("undefined"==typeof n.id)return o.warn("Trying to remove item from",this.name," store,","but no `id` property present on item:",n),e.reject();this.collection["delete"](n.id)}return e.resolve(n)},r}])}(window,window.angular),function(e,t,o){"use strict";t.module("Store.InstanceStore.Service",["Store.BaseStore.Service"]).factory("$instanceStore",["$q","$baseStore",function(e,o){function n(e,t){o.call(this,e,t),this.instance=null,this.promise=null}return t.extend(n.prototype,o.prototype),n.prototype.get=function(o,n){var r=this;return"boolean"==typeof o&&(n=o,o=null),this.instance&&!n?e.resolve(this.instance):this.promise?this.promise:t.isFunction(this.model.get)?(this.promise=this.model.get(o).then(function(e){return r.instance=e})["finally"](function(){return r.promise=null}),this.promise):(this.warnMissingMethod("get"),e.resolve([]))},n.prototype.set=function(e){var t=this;return this.validateIsModel(e,!0).then(function(e){return t.instance=e})},n.prototype.clear=function(){return this.instance=null,e.resolve()},n.prototype.save=function(e,t){return this.validateIsModel(e,!0).then(function(e){return e.save(t)})},n}])}(window,window.angular);
//# sourceMappingURL=angular-store.min.js.map
